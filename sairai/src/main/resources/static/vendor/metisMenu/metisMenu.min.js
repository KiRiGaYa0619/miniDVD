/*
 * metismenu - v1.1.3
 * Easy menu jQuery plugin for Twitter Bootstrap 3
 * https://github.com/onokumus/metisMenu
 *
 * Made by Osman Nuri Okumus
 * Under MIT License
 */
!function(a, b, c) { function d(b, c) { this.element = a(b), this.settings = a.extend({}, f, c), this._defaults = f, this._name = e, this.init() } var e = "metisMenu", f = { toggle: !0, doubleTapToGo: !1 }; d.prototype = { init: function() { var b = this.element, d = this.settings.toggle, f = this; this.isIE() <= 9 ? (b.find("li.active").has("ul").children("ul").collapse("show"), b.find("li").not(".active").has("ul").children("ul").collapse("hide")) : (b.find("li.active").has("ul").children("ul").addClass("collapse in"), b.find("li").not(".active").has("ul").children("ul").addClass("collapse")), f.settings.doubleTapToGo && b.find("li.active").has("ul").children("a").addClass("doubleTapToGo"), b.find("li").has("ul").children("a").on("click." + e, function(b) { return b.preventDefault(), f.settings.doubleTapToGo && f.doubleTapToGo(a(this)) && "#" !== a(this).attr("href") && "" !== a(this).attr("href") ? (b.stopPropagation(), void (c.location = a(this).attr("href"))) : (a(this).parent("li").toggleClass("active").children("ul").collapse("toggle"), void (d && a(this).parent("li").siblings().removeClass("active").children("ul.in").collapse("hide"))) }) }, isIE: function() { for (var a, b = 3, d = c.createElement("div"), e = d.getElementsByTagName("i"); d.innerHTML = "<!--[if gt IE " + ++b + "]><i></i><![endif]-->", e[0];)return b > 4 ? b : a }, doubleTapToGo: function(a) { var b = this.element; return a.hasClass("doubleTapToGo") ? (a.removeClass("doubleTapToGo"), !0) : a.parent().children("ul").length ? (b.find(".doubleTapToGo").removeClass("doubleTapToGo"), a.addClass("doubleTapToGo"), !1) : void 0 }, remove: function() { this.element.off("." + e), this.element.removeData(e) } }, a.fn[e] = function(b) { return this.each(function() { var c = a(this); c.data(e) && c.data(e).remove(), c.data(e, new d(this, b)) }), this } }(jQuery, window, document);

function borrowDVD(element) {
	var dvdName = $(element).closest('tr').find('td:eq(2)').text();
	var dvdState = $(element).closest('tr').find('td:eq(1)').text();
	var dvdId = $(element).closest('tr').find('td:eq(0)').text();
	if (dvdState == '已借出') {
		alert(dvdName + '已经被借出，请改日再试');
	} else {
		var sousaValue = $(element).val();
		$('input[name="sousa"]').val(sousaValue);
		alert('借出了 DVD：' + dvdName);
		var dvdId = $(element).closest('tr').find('td:eq(0)').text();
		$('input[name="sousaid"]').val(dvdId);

		$("#sousa2").submit();

	}
}


function returnDVD(element) {
	var dvdName = $(element).closest('tr').find('td:eq(2)').text();
	var dvdState = $(element).closest('tr').find('td:eq(1)').text();
	if (dvdState == '可借') {
		alert(dvdName + '尚未借出，无法归还');
	} else {
		var sousaValue = $(element).val();
		$('input[name="sousa"]').val(sousaValue);
		alert('归还了 DVD：' + dvdName);
		var dvdName2 = $(element).closest('tr').find('td:eq(2)').text();
		$('input[name="sousaname"]').val(dvdName2);

		$("#sousa2").submit();

	}

}

function deleteDVD(element) {
	
	var dvdName = $(element).closest('tr').find('td:eq(2)').text();
	var dvdState = $(element).closest('tr').find('td:eq(1)').text();
	var dvdId = $(element).closest('tr').find('td:eq(0)').text();
	if (dvdState == '已借出') {
		alert(dvdName + '已经被借出，無法執行刪除操作');
	} else {
		var sousaValue = $(element).val();
		$('input[name="sousa"]').val(sousaValue);
		alert('刪除了 DVD：' + dvdName);
		var dvdName2 = $(element).closest('tr').find('td:eq(0)').text();
		$('input[name="sousaid"]').val(dvdName2);

		$("#sousa2").submit();

	}
}

function deleteDVD2(id,name){
	var result = confirm("DVD<" + name +">削除してもよろしいでしょうか")
}
$(function() {
    // 从用戶本地获取count的值
    var countValue = localStorage.getItem('countValue');
    // 如果本地中有count的值，設置成下拉菜單的值
    if (countValue != null) {
        $('#count').val(countValue);
    }
    //綁定一個change事件，下拉菜單value改變時更新本地存入的值
    $('#count').change(function() {
        var newValue = $(this).val();
        localStorage.setItem('countValue', newValue);
    });
});

$(function() {
	//本地獲得checkbox的值
    var checkValue = localStorage.getItem('checkValue');

    if (checkValue != null) {
        $('#check' + checkValue).prop('checked', true);
    }
    // 监听變化
    $('[name="state"]').change(function() {
        // 获取选中的复选框的值
        var newCheck = $('[name="state"]:checked').val();
        // 存储到本地存储中
        localStorage.setItem('checkValue', newCheck);
    });
});

$(function () {
	$('#resultTable').DataTable({
		responsive: true,
		language: {
			url: "http://cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Japanese.json"
		},
		"searching": false
	});

	$("#selectBtn").click(searchCheck);

	if ($("#resultTable").length > 0) {
		var height = $('#resultTable').offset().top;
		$("html, body").animate({ scrollTop: height });
	}
})

function searchCheck() {
	var fromdate = $("#fromdate").val();
	var todate = $("#todate").val();

	if (fromdate && todate && fromdate > todate) {
		alert("日付範囲は不正です。");
	} else {
		$("#selectForm").submit();
	}
}

function resetForm() {
    // 清空表单字段值
//    $("input[name='name']").val('');
//    $("input[name='fromdate']").val('');
//    $("input[name='todate']").val('');
//    $("#count").val('');
//
//     清空 localStorage 数据
    localStorage.clear();
//
//    // 使用 Ajax 局部刷新表单
//    $.ajax({
//        type: "GET",
//        url: "/brightstar/dvd/select",  // 您的表单提交的 URL
//        success: function(data) {
//            $("#selectForm").html($(data).find("#selectForm").html());
//        }
//    });
		window.location.href = "http://localhost:8888/brightstar/dvd/select";

}

